# Обобщённые делегаты

Поддержка обобщенных делегатов в CLR позволяет передавать методам обратного вызова любые типы объектов, обеспечивая при этом безопасность типов. Более того, благодаря обобщенным делегатам экземпляры значимого типа могут передаваться методам обратного вызова без упаковки. Делегат — это просто определение класса с помощью четырех методов: конструктора и методов Invoke, BeginInvoke и EndInvoke. При определении типа делегата с параметрами типа компилятор задает методы класса делегата, а параметры типа применяются ко всем методам, параметры и возвращаемые значения которых относятся к указанному параметру типа.  
Например, обобщенный делегат определяется следующим образом:

```
 public delegate TReturn CallMe<TReturn, TKey, TValue>(
    TKey key, TValue value);
```

Компилятор превращает его в класс, который на логическом уровне выглядит так:

```
 public sealed class CallMe<TReturn, TKey, TValue> : MulticastDelegate {
    public CallMe(Object object, IntPtr method);    
    public virtual TReturn Invoke(TKey key, TValue value);
    public virtual IAsyncResult BeginInvoke(TKey key, TValue value,
         AsyncCallback callback, Object object);  
    public virtual TReturn EndInvoke(IAsyncResult result);
}
```

Каждый из параметров-типов обобщенного делегата должен быть помечен как ковариантный или контравариантный. Это позволяет вам осуществлять приведение типа переменной обобщенного делегата к тому же типу делегата с другим параметром-типом. Параметры-типы могут быть:

* **Инвариантными.** Параметр-тип не может изменяться. Пока в этой главе приводились только инвариантные параметры-типы. 
* **Контравариантными.** Параметр-тип может быть преобразован от класса к классу, производному от него. В языке C\# контравариантный тип обозначается ключевым словом in. Контравариантный параметр-тип может появляться только во входной позиции, например, в качестве аргументов метода. 
* **Ковариантными. **Аргумент-тип может быть преобразован от класса к одному из его базовых классов. В языке С\# ковариантный тип обозначается ключевым словом out. Ковариантный параметр обобщенного типа может появляться только в выходной позиции, например, в качестве возвращаемого значения метода. 



